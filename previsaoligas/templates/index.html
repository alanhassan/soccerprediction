<!DOCTYPE html>
<html>
<head>
    <title>Stripe Payment</title>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <h1>Welcome to the Pay-to-Use Website</h1>
    <button id="pay-button">Pay $10.00 to Use</button>
    <div id="card-element">
        <!-- A Stripe Element will be inserted here. -->
    </div>
    <form id="payment-form">
        <button id="submit-button" type="submit">Submit Payment</button>
    </form>

    <script>
        var stripe = Stripe('pk_live_51NhN89LvubjLVHJAYKT4DJiX6X83OSEyRbtagpUc0qN9TJR8Ibn4RF2bJDIc8USfwX2q6ZPc9h1Gap41MD4SWJ7Z00uXQd5tKZ');
        var elements = stripe.elements();
        var card = elements.create('card');

        document.getElementById('pay-button').addEventListener('click', function() {
            fetch('/create-payment-intent', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ amount: 200 }) // Replace with the desired amount in cents
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(paymentIntent) {
                if (card) {
                    card.destroy();
                }

                card = elements.create('card');
                card.mount('#card-element');

                var form = document.getElementById('payment-form');
                var submitButton = document.getElementById('submit-button');

                form.addEventListener('submit', function(event) {
                    event.preventDefault();
                    submitButton.disabled = true; // Disable the submit button
                    
                    stripe.confirmCardPayment(paymentIntent.client_secret, {
                        payment_method: {
                            card: card
                        }
                    }).then(function(result) {
                        if (result.error) {
                            console.error(result.error.message);
                        } else {
                            console.log('Payment successful:', result.paymentIntent.id);
                        }
                        
                        submitButton.disabled = false; // Re-enable the submit button
                    });
                });
            });
        });
    </script>
</body>
</html>